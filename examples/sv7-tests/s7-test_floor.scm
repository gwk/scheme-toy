(num-test (floor (+ 1 (expt 2 30))) 1073741825)
(num-test (floor (- (+ 1 -1/123400000))) -1)
(num-test (floor (- 1 1/123400000)) 0)
(num-test (floor (/ (- most-positive-fixnum 1) most-positive-fixnum)) 0)
(num-test (floor (/ -1 most-positive-fixnum)) -1)
(num-test (floor (/ 1 most-positive-fixnum)) 0)
(num-test (floor (/ most-negative-fixnum most-positive-fixnum)) -2)
(num-test (floor -0) 0)
(num-test (floor -0.0) 0)
(num-test (floor -0.1) -1)
(num-test (floor -0.9) -1)
(num-test (floor -1) -1)
(num-test (floor -1.1) -2)
(num-test (floor -1.9) -2)
(num-test (floor -1/10) -1)
(num-test (floor -1/123400000) -1)
(num-test (floor -1/2) -1)
(num-test (floor -100/3) -34)
(num-test (floor -11/10) -2)
(num-test (floor -17/2) -9)
(num-test (floor -19/10) -2)
(num-test (floor -2.225073858507201399999999999999999999996E-308) -1)
(num-test (floor -2/3) -1)
(num-test (floor -200/3) -67)
(num-test (floor -3/2) -2)
(num-test (floor -9/10) -1)
(num-test (floor -9223372036854775808) -9223372036854775808)
(num-test (floor 0) 0)
(num-test (floor 0.0) 0)
(num-test (floor 0.1) 0)
(num-test (floor 0.9) 0)
(num-test (floor 1) 1)
(num-test (floor 1.0-00.i) 1)
(num-test (floor 1.1) 1)
(num-test (floor 1.110223024625156799999999999999999999997E-16) 0)
(num-test (floor 1.9) 1)
(num-test (floor 1/10) 0)
(num-test (floor 1/123400000) 0)
(num-test (floor 1/2) 0)
(num-test (floor 100/3) 33)
(num-test (floor 11/10) 1)
(num-test (floor 17.3) 17)
(num-test (floor 19) 19)
(num-test (floor 19/10) 1)
(num-test (floor 2.5) 2)
(num-test (floor 2.6) 2)
(num-test (floor 2/3) 0)
(num-test (floor 200/3) 66)
(num-test (floor 3/2) 1)
(num-test (floor 9/10) 0)
(num-test (floor 9223372036854775807) 9223372036854775807)
(num-test (floor most-negative-fixnum) most-negative-fixnum)
(num-test (floor most-positive-fixnum) most-positive-fixnum)

(num-test (floor (+ 0.7 8388608.0)) 8388608)

(if with-bignums 
    (begin
      (num-test (floor 8388608.9999999995) 8388608)
      (num-test (floor 8388607.9999999995) 8388607)
      (num-test (floor 8388608.0000000005) 8388608)
      (num-test (floor 9007199254740992.95) 9007199254740992)
      (num-test (floor 9007199254740990.95) 9007199254740990)
      (num-test (floor 9007199254740993.95) 9007199254740993)
      (num-test (floor (+ 0.995 (expt 2.0 46))) 70368744177664)
      (num-test (floor (+ 0.9995 (expt 2.0 45))) 35184372088832)
      )
    (begin
      (test (floor 1e308) 'error)
      (test (floor 1e19) 'error)
      (test (floor -1e308) 'error)
      (test (floor -1e19) 'error)))

(test (= (floor (* 111738283365989051/177100989030047175 1.0)) (floor 130441933147714940/206745572560704147)) #t)
(test (= (floor (* 114243/80782 114243/80782 1.0)) (floor (* 275807/195025 275807/195025))) #f)
(test (= (floor (* 131836323/93222358 131836323/93222358 1.0)) (floor (* 318281039/225058681 318281039/225058681))) #f)
(test (= (floor (* 1393/985 1393/985 1.0)) (floor (* 3363/2378 3363/2378))) #f)
(test (= (floor (* 1607521/1136689 1607521/1136689 1.0)) (floor (* 3880899/2744210 3880899/2744210))) #f)
(if with-bignums (test (= (floor (* 1855077841/1311738121 1855077841/1311738121 1.0)) (floor (* 4478554083/3166815962 4478554083/3166815962))) #f))
(test (= (floor (* 19601/13860 19601/13860 1.0)) (floor (* 47321/33461 47321/33461))) #f)
(test (= (floor (* 275807/195025 275807/195025 1.0)) (floor (* 1607521/1136689 1607521/1136689))) #t)
(if with-bignums (test (= (floor (* 318281039/225058681 318281039/225058681 1.0)) (floor (* 1855077841/1311738121 1855077841/1311738121))) #t))
(test (= (floor (* 3363/2378 3363/2378 1.0)) (floor (* 19601/13860 19601/13860))) #t)
(test (= (floor (* 3880899/2744210 3880899/2744210 1.0)) (floor (* 9369319/6625109 9369319/6625109))) #f)
(test (= (floor (* 47321/33461 47321/33461 1.0)) (floor (* 114243/80782 114243/80782))) #f)
(test (= (floor (* 54608393/38613965 54608393/38613965 1.0)) (floor (* 131836323/93222358 131836323/93222358))) #f)
(test (= (floor (* 9369319/6625109 9369319/6625109 1.0)) (floor (* 54608393/38613965 54608393/38613965))) #t)

(if with-bignums 
    (begin
      (num-test (floor (+ (expt 2.0 62) 512)) 4611686018427388416)
      (num-test (floor (+ (expt 2.0 62) 513)) 4611686018427388417)
      (num-test (floor (exact->inexact most-negative-fixnum)) most-negative-fixnum)
      (test (floor (exact->inexact most-positive-fixnum)) most-positive-fixnum)

      (num-test (floor 1e19) 10000000000000000000)
      (num-test (floor 1e32) 100000000000000000000000000000000)
      (num-test (floor -1e19) -10000000000000000000)
      (num-test (floor -1e32) -100000000000000000000000000000000)
      (num-test (floor 100000000000000000000000000000000/3) 33333333333333333333333333333333)
      (num-test (floor -100000000000000000000000000000000/3) -33333333333333333333333333333334)
      (num-test (floor 200000000000000000000000000000000/3) 66666666666666666666666666666666)
      (num-test (floor -200000000000000000000000000000000/3) -66666666666666666666666666666667)

      (test (= (floor (* 1180872205318713601/835002744095575440 1180872205318713601/835002744095575440 1.0)) 
	       (floor (* 2850877693509864481/2015874949414289041 2850877693509864481/2015874949414289041))) #f)
      (test (= (floor (* 1362725501650887306817/963592443113182178088 1362725501650887306817/963592443113182178088 1.0)) 
	       (floor (* 3289910387877251662993/2326317944764069484905 3289910387877251662993/2326317944764069484905))) #f)
      (test (= (floor (* 14398739476117879/10181446324101389 14398739476117879/10181446324101389 1.0)) 
	       (floor (* 34761632124320657/24580185800219268 34761632124320657/24580185800219268))) #f)
      (test (= (floor (* 202605639573839043/143263821649299118 202605639573839043/143263821649299118 1.0)) 
	       (floor (* 489133282872437279/345869461223138161 489133282872437279/345869461223138161))) #f)
      (test (= (floor (* 2850877693509864481/2015874949414289041 2850877693509864481/2015874949414289041 1.0)) 
	       (floor (* 16616132878186749607/11749380235262596085 16616132878186749607/11749380235262596085))) #t)
      (test (= (floor (* 34761632124320657/24580185800219268 34761632124320657/24580185800219268 1.0)) 
	       (floor (* 202605639573839043/143263821649299118 202605639573839043/143263821649299118))) #t)
      (test (= (floor (* 40114893348711941777/28365513113449345692 40114893348711941777/28365513113449345692 1.0)) 
	       (floor (* 96845919575610633161/68480406462161287469 96845919575610633161/68480406462161287469))) #f)
      (test (= (floor (* 46292552162781456490001/32733777552734744709300 46292552162781456490001/32733777552734744709300 1.0)) 
	       (floor (* 111760107268250945908601/79026329715516201199301 111760107268250945908601/79026329715516201199301))) #f)
      (test (= (floor (* 489133282872437279/345869461223138161 489133282872437279/345869461223138161 1.0)) 
	       (floor (* 1180872205318713601/835002744095575440 1180872205318713601/835002744095575440))) #f)
      (test (= (floor (* 5964153172084899/4217293152016490 5964153172084899/4217293152016490 1.0)) 
	       (floor (* 14398739476117879/10181446324101389 14398739476117879/10181446324101389))) #f)
      ))

(let ((val1 (catch #t (lambda () (floor 0.0)) (lambda args 'error)))
      (val2 (catch #t (lambda () (floor -0.0)) (lambda args 'error))))
  (test (equal? val1 val2) #t))

(test (floor) 'error)
(test (floor 1.23+1.0i) 'error)
(test (floor 1.23 1.23) 'error)

(for-each
 (lambda (arg)
   (test (floor arg) 'error))
 (list "hi" '() (integer->char 65) #f #t '(1 2) _ht_ 'a-symbol (cons 1 2) (make-vector 3) abs 
       #<eof> '(1 2 3) #\newline (lambda (a) (+ a 1)) #<unspecified> #<undefined>))
